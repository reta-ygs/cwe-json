{"cwe": {"@ID": "116", "@Name": "Improper Encoding or Escaping of Output", "@Abstraction": "Class", "@Structure": "Simple", "@Status": "Draft", "Description": "The product prepares a structured message for communication with another component, but encoding or escaping of the data is either missing or done incorrectly. As a result, the intended structure of the message is not preserved.", "Extended_Description": {"xhtml:p": ["Improper encoding or escaping can allow attackers to change the commands that are sent to another component, inserting malicious commands instead.", "Most products follow a certain protocol that uses structured messages for communication between components, such as queries or commands. These structured messages can contain raw data interspersed with metadata or control information. For example, \"GET /index.html HTTP/1.1\" is a structured message containing a command (\"GET\") with a single argument (\"/index.html\") and metadata about which protocol version is being used (\"HTTP/1.1\").", "If an application uses attacker-supplied inputs to construct a structured message without properly encoding or escaping, then the attacker could insert special characters that will cause the data to be interpreted as control information or metadata. Consequently, the component that receives the output will perform the wrong operations, or otherwise interpret the data incorrectly."]}, "Related_Weaknesses": {"Related_Weakness": [{"@Nature": "ChildOf", "@CWE_ID": "707", "@View_ID": "1000", "@Ordinal": "Primary"}, {"@Nature": "CanPrecede", "@CWE_ID": "74", "@View_ID": "1000"}]}, "Applicable_Platforms": {"Language": {"@Class": "Not Language-Specific", "@Prevalence": "Often"}, "Technology": [{"@Name": "Database Server", "@Prevalence": "Often"}, {"@Name": "Web Server", "@Prevalence": "Often"}]}, "Alternate_Terms": {"Alternate_Term": [{"Term": "Output Sanitization"}, {"Term": "Output Validation"}, {"Term": "Output Encoding"}]}, "Modes_Of_Introduction": {"Introduction": [{"Phase": "Implementation"}, {"Phase": "Operation"}]}, "Likelihood_Of_Exploit": "High", "Common_Consequences": {"Consequence": [{"Scope": "Integrity", "Impact": "Modify Application Data", "Note": "The communications between components can be modified in unexpected ways. Unexpected commands can be executed, bypassing other security mechanisms. Incoming data can be misinterpreted."}, {"Scope": ["Integrity", "Confidentiality", "Availability", "Access Control"], "Impact": "Execute Unauthorized Code or Commands", "Note": "The communications between components can be modified in unexpected ways. Unexpected commands can be executed, bypassing other security mechanisms. Incoming data can be misinterpreted."}, {"Scope": "Confidentiality", "Impact": "Bypass Protection Mechanism", "Note": "The communications between components can be modified in unexpected ways. Unexpected commands can be executed, bypassing other security mechanisms. Incoming data can be misinterpreted."}]}, "Detection_Methods": {"Detection_Method": [{"@Detection_Method_ID": "DM-1", "Method": "Automated Static Analysis", "Description": "This weakness can often be detected using automated static analysis tools. Many modern tools use data flow analysis or constraint-based techniques to minimize the number of false positives.", "Effectiveness": "Moderate", "Effectiveness_Notes": "This is not a perfect solution, since 100% accuracy and coverage are not feasible."}, {"@Detection_Method_ID": "DM-2", "Method": "Automated Dynamic Analysis", "Description": "This weakness can be detected using dynamic tools and techniques that interact with the software using large test suites with many diverse inputs, such as fuzz testing (fuzzing), robustness testing, and fault injection. The software's operation may slow down, but it should not become unstable, crash, or generate incorrect results."}]}, "Potential_Mitigations": {"Mitigation": [{"@Mitigation_ID": "MIT-4.3", "Phase": "Architecture and Design", "Strategy": "Libraries or Frameworks", "Description": {"xhtml:p": ["Use a vetted library or framework that does not allow this weakness to occur or provides constructs that make this weakness easier to avoid.", "For example, consider using the ESAPI Encoding control [REF-45] or a similar tool, library, or framework. These will help the programmer encode outputs in a manner less prone to error.", "Alternately, use built-in functions, but consider using wrappers in case those functions are discovered to have a vulnerability."]}}, {"@Mitigation_ID": "MIT-27", "Phase": "Architecture and Design", "Strategy": "Parameterization", "Description": {"xhtml:p": ["If available, use structured mechanisms that automatically enforce the separation between data and code. These mechanisms may be able to provide the relevant quoting, encoding, and validation automatically, instead of relying on the developer to provide this capability at every point where output is generated.", "For example, stored procedures can enforce database query structure and reduce the likelihood of SQL injection."]}}, {"Phase": ["Architecture and Design", "Implementation"], "Description": "Understand the context in which your data will be used and the encoding that will be expected. This is especially important when transmitting data between different components, or when generating outputs that can contain multiple encodings at the same time, such as web pages or multi-part mail messages. Study all expected communication protocols and data representations to determine the required encoding strategies."}, {"Phase": "Architecture and Design", "Description": "In some cases, input validation may be an important strategy when output encoding is not a complete solution. For example, you may be providing the same output that will be processed by multiple consumers that use different encodings or representations. In other cases, you may be required to allow user-supplied input to contain control information, such as limited HTML tags that support formatting in a wiki or bulletin board. When this type of requirement must be met, use an extremely strict allowlist to limit which control sequences can be used. Verify that the resulting syntactic structure is what you expect. Use your normal encoding methods for the remainder of the input."}, {"Phase": "Architecture and Design", "Description": "Use input validation as a defense-in-depth measure to reduce the likelihood of output encoding errors (see CWE-20)."}, {"Phase": "Requirements", "Description": "Fully specify which encodings are required by components that will be communicating with each other."}, {"Phase": "Implementation", "Description": "When exchanging data between components, ensure that both components are using the same character encoding. Ensure that the proper encoding is applied at each interface. Explicitly set the encoding you are using whenever the protocol allows you to do so."}]}, "Demonstrative_Examples": {"Demonstrative_Example": [{"Intro_Text": "This code displays an email address that was submitted as part of a form.", "Example_Code": {"@Nature": "Bad", "@Language": "JSP", "xhtml:div": {"xhtml:br": [null, null], "#text": "<% String email = request.getParameter(\"email\"); %>...Email Address: <%= email %>"}}, "Body_Text": "The value read from the form parameter is reflected back to the client browser without having been encoded prior to output, allowing various XSS attacks (CWE-79)."}, {"Intro_Text": "Consider a chat application in which a front-end web application communicates with a back-end server. The back-end is legacy code that does not perform authentication or authorization, so the front-end must implement it. The chat protocol supports two commands, SAY and BAN, although only administrators can use the BAN command. Each argument must be separated by a single space. The raw inputs are URL-encoded. The messaging protocol allows multiple commands to be specified on the same line if they are separated by a \"|\" character.", "Body_Text": ["First let's look at the back end command processor code", "The front end web application receives a command, encodes it for sending to the server, performs the authorization check, and sends the command to the server.", "It is clear that, while the protocol and back-end allow multiple commands to be sent in a single request, the front end only intends to send a single command. However, the UrlEncode function could leave the \"|\" character intact. If an attacker provides:", "then the front end will see this is a \"SAY\" command, and the $argstr will look like \"hello world | BAN user12\". Since the command is \"SAY\", the check for the \"BAN\" command will fail, and the front end will send the URL-encoded command to the back end:", "The back end, however, will treat these as two separate commands:", "Notice, however, that if the front end properly encodes the \"|\" with \"%7C\", then the back end will only process a single command."], "Example_Code": [{"@Nature": "Bad", "@Language": "Perl", "xhtml:div": {"xhtml:br": [null, null, null, null, null], "xhtml:i": "# generate an array of strings separated by the \"|\" character.", "xhtml:div": {"@style": "margin-left:1em;", "xhtml:br": [null, null, null, null, null, null], "xhtml:i": "# separate the operator from its arguments based on a single whitespace", "xhtml:div": [{"@style": "margin-left:1em;", "#text": "ExecuteBan($args);"}, {"@style": "margin-left:1em;", "#text": "ExecuteSay($args);"}], "#text": "($operator, $args) = split(/ /, $cmd, 2);\n                        $args = UrlDecode($args);if ($operator eq \"BAN\") {}elsif ($operator eq \"SAY\") {}"}, "#text": "$inputString = readLineFromFileHandle($serverFH);\n                     \n                     \n                     @commands = split(/\\|/, $inputString);\n                     foreach $cmd (@commands) {}"}}, {"@Nature": "Bad", "@Language": "Perl", "xhtml:div": {"xhtml:br": [null, null, null, null, null, null, null, null, null, null, null, null], "xhtml:i": ["# removes extra whitespace and also changes CRLF's to spaces", "# communicate with file server using a file handle"], "xhtml:div": {"@style": "margin-left:1em;", "#text": "die \"Error: you are not the admin.\\n\";"}, "#text": "$inputString = GetUntrustedArgument(\"command\");($cmd, $argstr) = split(/\\s+/, $inputString, 2);\n                     \n                     \n                     $argstr =~ s/\\s+/ /gs;\n                     $argstr = UrlEncode($argstr);if (($cmd eq \"BAN\") && (! IsAdministrator($username))) {}\n                     \n                     \n                     $fh = GetServerFileHandle(\"myserver\");\n                     print $fh \"$cmd $argstr\\n\";"}}, {"@Nature": "Attack", "xhtml:div": "SAY hello world|BAN user12"}, {"@Nature": "Result", "xhtml:div": "SAY hello%20world|BAN%20user12"}, {"@Nature": "Result", "xhtml:div": {"xhtml:br": null, "#text": "SAY hello worldBAN user12"}}]}, {"Intro_Text": "This example takes user input, passes it through an encoding scheme and then creates a directory specified by the user.", "Example_Code": [{"@Nature": "Bad", "@Language": "Perl", "xhtml:div": {"xhtml:div": [{"@style": "margin-left:1em;", "#text": "return($ARGV[0]);"}, {"@style": "margin-left:1em;", "xhtml:br": [null, null, null, null, null, null], "#text": "my($str) = @_;$str =~ s/\\&/\\&amp;/gs;$str =~ s/\\\"/\\&quot;/gs;$str =~ s/\\'/\\&apos;/gs;$str =~ s/\\</\\&lt;/gs;$str =~ s/\\>/\\&gt;/gs;return($str);"}, {"@style": "margin-left:1em;", "xhtml:br": [null, null, null], "#text": "my $uname = encode(GetUntrustedInput(\"username\"));print \"<b>Welcome, $uname!</b><p>\\n\";system(\"cd /home/$uname; /bin/ls -l\");"}], "xhtml:br": [null, null, null, null], "#text": "sub GetUntrustedInput {}\n                     sub encode {}\n                     sub doit {}"}}, {"@Nature": "Attack", "xhtml:div": "' pwd"}], "Body_Text": ["The programmer attempts to encode dangerous characters, however the denylist for encoding is incomplete (CWE-184) and an attacker can still pass a semicolon, resulting in a chain with command injection (CWE-77).", "Additionally, the encoding routine is used inappropriately with command execution. An attacker doesn't even need to insert their own semicolon. The attacker can instead leverage the encoding routine to provide the semicolon to separate the commands. If an attacker supplies a string of the form:", "then the program will encode the apostrophe and insert the semicolon, which functions as a command separator when passed to the system function. This allows the attacker to complete the command injection."]}]}, "Observed_Examples": {"Observed_Example": [{"Reference": "CVE-2021-41232", "Description": "Chain: authentication routine in Go-based agile development product does not escape user name (CWE-116), allowing LDAP injection (CWE-90)", "Link": "https://www.cve.org/CVERecord?id=CVE-2021-41232"}, {"Reference": "CVE-2008-4636", "Description": "OS command injection in backup software using shell metacharacters in a filename; correct behavior would require that this filename could not be changed.", "Link": "https://www.cve.org/CVERecord?id=CVE-2008-4636"}, {"Reference": "CVE-2008-0769", "Description": "Web application does not set the charset when sending a page to a browser, allowing for XSS exploitation when a browser chooses an unexpected encoding.", "Link": "https://www.cve.org/CVERecord?id=CVE-2008-0769"}, {"Reference": "CVE-2008-0005", "Description": "Program does not set the charset when sending a page to a browser, allowing for XSS exploitation when a browser chooses an unexpected encoding.", "Link": "https://www.cve.org/CVERecord?id=CVE-2008-0005"}, {"Reference": "CVE-2008-5573", "Description": "SQL injection via password parameter; a strong password might contain \"&\"", "Link": "https://www.cve.org/CVERecord?id=CVE-2008-5573"}, {"Reference": "CVE-2008-3773", "Description": "Cross-site scripting in chat application via a message subject, which normally might contain \"&\" and other XSS-related characters.", "Link": "https://www.cve.org/CVERecord?id=CVE-2008-3773"}, {"Reference": "CVE-2008-0757", "Description": "Cross-site scripting in chat application via a message, which normally might be allowed to contain arbitrary content.", "Link": "https://www.cve.org/CVERecord?id=CVE-2008-0757"}]}, "Taxonomy_Mappings": {"Taxonomy_Mapping": [{"@Taxonomy_Name": "WASC", "Entry_ID": "22", "Entry_Name": "Improper Output Handling"}, {"@Taxonomy_Name": "The CERT Oracle Secure Coding Standard for Java (2011)", "Entry_ID": "IDS00-J", "Entry_Name": "Sanitize untrusted data passed across a trust boundary", "Mapping_Fit": "Exact"}, {"@Taxonomy_Name": "The CERT Oracle Secure Coding Standard for Java (2011)", "Entry_ID": "IDS05-J", "Entry_Name": "Use a subset of ASCII for file and path names"}, {"@Taxonomy_Name": "SEI CERT Oracle Coding Standard for Java", "Entry_ID": "IDS00-J", "Entry_Name": "Prevent SQL injection", "Mapping_Fit": "Imprecise"}, {"@Taxonomy_Name": "SEI CERT Perl Coding Standard", "Entry_ID": "IDS33-PL", "Entry_Name": "Sanitize untrusted data passed across a trust boundary", "Mapping_Fit": "Exact"}]}, "Related_Attack_Patterns": {"Related_Attack_Pattern": [{"@CAPEC_ID": "104"}, {"@CAPEC_ID": "73"}, {"@CAPEC_ID": "81"}, {"@CAPEC_ID": "85"}]}, "References": {"Reference": [{"@External_Reference_ID": "REF-45"}, {"@External_Reference_ID": "REF-46"}, {"@External_Reference_ID": "REF-47"}, {"@External_Reference_ID": "REF-48"}, {"@External_Reference_ID": "REF-49"}, {"@External_Reference_ID": "REF-50"}, {"@External_Reference_ID": "REF-7", "@Section": "Chapter 11, \"Canonical Representation Issues\" Page 363"}]}, "Notes": {"Note": [{"@Type": "Relationship", "#text": "This weakness is primary to all weaknesses related to injection (CWE-74) since the inherent nature of injection involves the violation of structured messages."}, {"@Type": "Relationship", "xhtml:p": ["CWE-116 and CWE-20 have a close association because, depending on the nature of the structured message, proper input validation can indirectly prevent special characters from changing the meaning of a structured message. For example, by validating that a numeric ID field should only contain the 0-9 characters, the programmer effectively prevents injection attacks.", "However, input validation is not always sufficient, especially when less stringent data types must be supported, such as free-form text. Consider a SQL injection scenario in which a last name is inserted into a query. The name \"O'Reilly\" would likely pass the validation step since it is a common last name in the English language. However, it cannot be directly inserted into the database because it contains the \"'\" apostrophe character, which would need to be escaped or otherwise neutralized. In this case, stripping the apostrophe might reduce the risk of SQL injection, but it would produce incorrect behavior because the wrong name would be recorded."]}, {"@Type": "Terminology", "#text": "The usage of the \"encoding\" and \"escaping\" terms varies widely. For example, in some programming languages, the terms are used interchangeably, while other languages provide APIs that use both terms for different tasks. This overlapping usage extends to the Web, such as the \"escape\" JavaScript function whose purpose is stated to be encoding. The concepts of encoding and escaping predate the Web by decades. Given such a context, it is difficult for CWE to adopt a consistent vocabulary that will not be misinterpreted by some constituency."}, {"@Type": "Theoretical", "#text": "This is a data/directive boundary error in which data boundaries are not sufficiently enforced before it is sent to a different control sphere."}, {"@Type": "Research Gap", "#text": "While many published vulnerabilities are related to insufficient output encoding, there is such an emphasis on input validation as a protection mechanism that the underlying causes are rarely described. Within CVE, the focus is primarily on well-understood issues like cross-site scripting and SQL injection. It is likely that this weakness frequently occurs in custom protocols that support multiple encodings, which are not necessarily detectable with automated techniques."}]}, "Content_History": {"Submission": {"Submission_Name": "CWE Community", "Submission_Date": "2006-07-19", "Submission_Comment": "Submitted by members of the CWE community to extend early CWE versions"}, "Modification": [{"Modification_Name": "Sean Eidemiller", "Modification_Organization": "Cigital", "Modification_Date": "2008-07-01", "Modification_Comment": "added/updated demonstrative examples"}, {"Modification_Name": "Eric Dalci", "Modification_Organization": "Cigital", "Modification_Date": "2008-07-01", "Modification_Comment": "updated Time_of_Introduction"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2008-09-08", "Modification_Comment": "updated Name, Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2009-01-12", "Modification_Comment": "updated Alternate_Terms, Applicable_Platforms, Common_Consequences, Demonstrative_Examples, Description, Likelihood_of_Exploit, Name, Observed_Examples, Potential_Mitigations, References, Relationship_Notes, Relationships, Research_Gaps, Terminology_Notes, Theoretical_Notes"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2009-03-10", "Modification_Comment": "updated Description, Potential_Mitigations"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2009-05-27", "Modification_Comment": "updated Related_Attack_Patterns"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2009-07-27", "Modification_Comment": "updated Demonstrative_Examples"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2009-10-29", "Modification_Comment": "updated Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2009-12-28", "Modification_Comment": "updated Demonstrative_Examples, Potential_Mitigations"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2010-02-16", "Modification_Comment": "updated Detection_Factors, Potential_Mitigations, References, Taxonomy_Mappings"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2010-04-05", "Modification_Comment": "updated Potential_Mitigations"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2010-06-21", "Modification_Comment": "updated Potential_Mitigations"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2011-03-29", "Modification_Comment": "updated Relationship_Notes, Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2011-06-01", "Modification_Comment": "updated Common_Consequences, Relationships, Taxonomy_Mappings"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2011-09-13", "Modification_Comment": "updated Relationships, Taxonomy_Mappings"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2012-05-11", "Modification_Comment": "updated References, Relationships, Taxonomy_Mappings"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2012-10-30", "Modification_Comment": "updated Potential_Mitigations"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2014-06-23", "Modification_Comment": "updated References"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2014-07-30", "Modification_Comment": "updated Demonstrative_Examples, Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2015-12-07", "Modification_Comment": "updated Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2017-01-19", "Modification_Comment": "updated Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2017-05-03", "Modification_Comment": "updated Related_Attack_Patterns"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2017-11-08", "Modification_Comment": "updated Applicable_Platforms, Common_Consequences, Demonstrative_Examples, Likelihood_of_Exploit, References, Taxonomy_Mappings"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2018-03-27", "Modification_Comment": "updated References"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2019-01-03", "Modification_Comment": "updated Relationships, Taxonomy_Mappings"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2019-06-20", "Modification_Comment": "updated Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2020-02-24", "Modification_Comment": "updated Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2020-06-25", "Modification_Comment": "updated Applicable_Platforms, Demonstrative_Examples, Potential_Mitigations"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2021-03-15", "Modification_Comment": "updated Relationships, Terminology_Notes"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2021-10-28", "Modification_Comment": "updated Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2022-10-13", "Modification_Comment": "updated Observed_Examples"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2023-01-31", "Modification_Comment": "updated Description"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2023-04-27", "Modification_Comment": "updated References, Relationships, Time_of_Introduction"}], "Previous_Entry_Name": [{"@Date": "2008-04-11", "#text": "Output Validation"}, {"@Date": "2008-09-09", "#text": "Incorrect Output Sanitization"}, {"@Date": "2009-01-12", "#text": "Insufficient Output Sanitization"}]}}, "copyright": "Copyright \u00a9 2006\u20132023, The MITRE Corporation. CWE, CWSS, CWRAF, and the CWE logo are trademarks of The MITRE Corporation.", "license": "CWE Usage: MITRE hereby grants you a non-exclusive, royalty-free license to use CWE for research, development, and commercial purposes. Any copy you make for such purposes is authorized on the condition that you reproduce MITRE\u2019s copyright designation and this license in any such copy."}