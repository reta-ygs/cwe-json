{"@ID": "352", "@Name": "Cross-Site Request Forgery (CSRF)", "@Abstraction": "Compound", "@Structure": "Composite", "@Status": "Stable", "Description": "The web application does not, or can not, sufficiently verify whether a well-formed, valid, consistent request was intentionally provided by the user who submitted the request.", "Extended_Description": "When a web server is designed to receive a request from a client without any mechanism for verifying that it was intentionally sent, then it might be possible for an attacker to trick a client into making an unintentional request to the web server which will be treated as an authentic request. This can be done via a URL, image load, XMLHttpRequest, etc. and can result in exposure of data or unintended code execution.", "Related_Weaknesses": {"Related_Weakness": [{"@Nature": "ChildOf", "@CWE_ID": "345", "@View_ID": "1000", "@Ordinal": "Primary"}, {"@Nature": "ChildOf", "@CWE_ID": "345", "@View_ID": "1003", "@Ordinal": "Primary"}, {"@Nature": "Requires", "@CWE_ID": "346", "@View_ID": "1000"}, {"@Nature": "Requires", "@CWE_ID": "441", "@View_ID": "1000"}, {"@Nature": "Requires", "@CWE_ID": "642", "@View_ID": "1000"}, {"@Nature": "Requires", "@CWE_ID": "613", "@View_ID": "1000"}]}, "Applicable_Platforms": {"Language": {"@Class": "Not Language-Specific", "@Prevalence": "Undetermined"}, "Technology": {"@Name": "Web Server", "@Prevalence": "Undetermined"}}, "Alternate_Terms": {"Alternate_Term": [{"Term": "Session Riding"}, {"Term": "Cross Site Reference Forgery"}, {"Term": "XSRF"}]}, "Modes_Of_Introduction": {"Introduction": {"Phase": "Architecture and Design", "Note": "REALIZATION: This weakness is caused during implementation of an architectural security tactic."}}, "Likelihood_Of_Exploit": "Medium", "Common_Consequences": {"Consequence": {"Scope": ["Confidentiality", "Integrity", "Availability", "Non-Repudiation", "Access Control"], "Impact": ["Gain Privileges or Assume Identity", "Bypass Protection Mechanism", "Read Application Data", "Modify Application Data", "DoS: Crash, Exit, or Restart"], "Note": "The consequences will vary depending on the nature of the functionality that is vulnerable to CSRF. An attacker could effectively perform any operations as the victim. If the victim is an administrator or privileged user, the consequences may include obtaining complete control over the web application - deleting or stealing data, uninstalling the product, or using it to launch other attacks against all of the product's users. Because the attacker has the identity of the victim, the scope of CSRF is limited only by the victim's privileges."}}, "Detection_Methods": {"Detection_Method": [{"@Detection_Method_ID": "DM-7", "Method": "Manual Analysis", "Description": {"xhtml:p": ["This weakness can be detected using tools and techniques that require manual (human) analysis, such as penetration testing, threat modeling, and interactive tools that allow the tester to record and modify an active session.", "Specifically, manual analysis can be useful for finding this weakness, and for minimizing false positives assuming an understanding of business logic. However, it might not achieve desired code coverage within limited time constraints. For black-box analysis, if credentials are not known for privileged accounts, then the most security-critical portions of the application may not receive sufficient attention.", "Consider using OWASP CSRFTester to identify potential issues and aid in manual analysis."]}, "Effectiveness": "High", "Effectiveness_Notes": "These may be more effective than strictly automated techniques. This is especially the case with weaknesses that are related to design and business rules."}, {"Method": "Automated Static Analysis", "Description": "CSRF is currently difficult to detect reliably using automated techniques. This is because each application has its own implicit security policy that dictates which requests can be influenced by an outsider and automatically performed on behalf of a user, versus which requests require strong confidence that the user intends to make the request. For example, a keyword search of the public portion of a web site is typically expected to be encoded within a link that can be launched automatically when the user clicks on the link.", "Effectiveness": "Limited"}, {"Method": "Automated Static Analysis - Binary or Bytecode", "Description": {"xhtml:p": "According to SOAR, the following detection techniques may be useful:", "xhtml:div": {"@style": "margin-left:1em;", "xhtml:div": "Cost effective for partial coverage:", "xhtml:ul": {"xhtml:li": ["Bytecode Weakness Analysis - including disassembler + source code weakness analysis", "Binary Weakness Analysis - including disassembler + source code weakness analysis"]}}}, "Effectiveness": "SOAR Partial"}, {"Method": "Manual Static Analysis - Binary or Bytecode", "Description": {"xhtml:p": "According to SOAR, the following detection techniques may be useful:", "xhtml:div": {"@style": "margin-left:1em;", "xhtml:div": "Cost effective for partial coverage:", "xhtml:ul": {"xhtml:li": "Binary / Bytecode disassembler - then use manual analysis for vulnerabilities & anomalies"}}}, "Effectiveness": "SOAR Partial"}, {"Method": "Dynamic Analysis with Automated Results Interpretation", "Description": {"xhtml:p": "According to SOAR, the following detection techniques may be useful:", "xhtml:div": {"@style": "margin-left:1em;", "xhtml:div": "Highly cost effective:", "xhtml:ul": {"xhtml:li": "Web Application Scanner"}}}, "Effectiveness": "High"}, {"Method": "Dynamic Analysis with Manual Results Interpretation", "Description": {"xhtml:p": "According to SOAR, the following detection techniques may be useful:", "xhtml:div": {"@style": "margin-left:1em;", "xhtml:div": "Highly cost effective:", "xhtml:ul": {"xhtml:li": ["Fuzz Tester", "Framework-based Fuzzer"]}}}, "Effectiveness": "High"}, {"Method": "Manual Static Analysis - Source Code", "Description": {"xhtml:p": "According to SOAR, the following detection techniques may be useful:", "xhtml:div": {"@style": "margin-left:1em;", "xhtml:div": "Cost effective for partial coverage:", "xhtml:ul": {"xhtml:li": ["Focused Manual Spotcheck - Focused manual analysis of source", "Manual Source Code Review (not inspections)"]}}}, "Effectiveness": "SOAR Partial"}, {"Method": "Automated Static Analysis - Source Code", "Description": {"xhtml:p": "According to SOAR, the following detection techniques may be useful:", "xhtml:div": {"@style": "margin-left:1em;", "xhtml:div": "Cost effective for partial coverage:", "xhtml:ul": {"xhtml:li": ["Source code Weakness Analyzer", "Context-configured Source Code Weakness Analyzer"]}}}, "Effectiveness": "SOAR Partial"}, {"Method": "Architecture or Design Review", "Description": {"xhtml:p": "According to SOAR, the following detection techniques may be useful:", "xhtml:div": {"@style": "margin-left:1em;", "xhtml:div": "Cost effective for partial coverage:", "xhtml:ul": {"xhtml:li": ["Inspection (IEEE 1028 standard) (can apply to requirements, design, source code, etc.)", "Formal Methods / Correct-By-Construction"]}}}, "Effectiveness": "SOAR Partial"}]}, "Potential_Mitigations": {"Mitigation": [{"@Mitigation_ID": "MIT-4", "Phase": "Architecture and Design", "Strategy": "Libraries or Frameworks", "Description": {"xhtml:p": ["Use a vetted library or framework that does not allow this weakness to occur or provides constructs that make this weakness easier to avoid.", "For example, use anti-CSRF packages such as the OWASP CSRFGuard. [REF-330]", "Another example is the ESAPI Session Management control, which includes a component for CSRF. [REF-45]"]}}, {"Phase": "Implementation", "Description": "Ensure that the application is free of cross-site scripting issues (CWE-79), because most CSRF defenses can be bypassed using attacker-controlled script."}, {"Phase": "Architecture and Design", "Description": "Generate a unique nonce for each form, place the nonce into the form, and verify the nonce upon receipt of the form. Be sure that the nonce is not predictable (CWE-330). [REF-332]", "Effectiveness_Notes": "Note that this can be bypassed using XSS (CWE-79)."}, {"Phase": "Architecture and Design", "Description": "Identify especially dangerous operations. When the user performs a dangerous operation, send a separate confirmation request to ensure that the user intended to perform that operation.", "Effectiveness_Notes": "Note that this can be bypassed using XSS (CWE-79)."}, {"Phase": "Architecture and Design", "Description": {"xhtml:p": ["Use the \"double-submitted cookie\" method as described by Felten and Zeller:", "When a user visits a site, the site should generate a pseudorandom value and set it as a cookie on the user's machine. The site should require every form submission to include this value as a form value and also as a cookie value. When a POST request is sent to the site, the request should only be considered valid if the form value and the cookie value are the same.", "Because of the same-origin policy, an attacker cannot read or modify the value stored in the cookie. To successfully submit a form on behalf of the user, the attacker would have to correctly guess the pseudorandom value. If the pseudorandom value is cryptographically strong, this will be prohibitively difficult.", "This technique requires Javascript, so it may not work for browsers that have Javascript disabled. [REF-331]"]}, "Effectiveness_Notes": "Note that this can probably be bypassed using XSS (CWE-79), or when using web technologies that enable the attacker to read raw headers from HTTP requests."}, {"Phase": "Architecture and Design", "Description": "Do not use the GET method for any request that triggers a state change."}, {"Phase": "Implementation", "Description": "Check the HTTP Referer header to see if the request originated from an expected page. This could break legitimate functionality, because users or proxies may have disabled sending the Referer for privacy reasons.", "Effectiveness_Notes": "Note that this can be bypassed using XSS (CWE-79). An attacker could use XSS to generate a spoofed Referer, or to generate a malicious request from a page whose Referer would be allowed."}]}, "Demonstrative_Examples": {"Demonstrative_Example": {"Intro_Text": "This example PHP code attempts to secure the form submission process by validating that the user submitting the form has a valid session. A CSRF attack would not be prevented by this countermeasure because the attacker forges a request through the user's web browser in which a valid session already exists.", "Body_Text": ["The following HTML is intended to allow a user to update a profile.", "profile.php contains the following code.", "This code may look protected since it checks for a valid session. However, CSRF attacks can be staged from virtually any tag or HTML construct, including image tags, links, embed or object tags, or other attributes that load background images.", "The attacker can then host code that will silently change the username and email address of any user that visits the page while remaining logged in to the target web application. The code might be an innocent-looking web page such as:", "Notice how the form contains hidden fields, so when it is loaded into the browser, the user will not notice it. Because SendAttack() is defined in the body's onload attribute, it will be automatically called when the victim loads the web page.", "Assuming that the user is already logged in to victim.example.com, profile.php will see that a valid user session has been established, then update the email address to the attacker's own address. At this stage, the user's identity has been compromised, and messages sent through this profile could be sent to the attacker's address."], "Example_Code": [{"@Nature": "Bad", "@Language": "HTML", "xhtml:div": {"xhtml:br": [null, null, null, null, null, null], "#text": "<form action=\"/url/profile.php\" method=\"post\"><input type=\"text\" name=\"firstname\"/><input type=\"text\" name=\"lastname\"/><br/><input type=\"text\" name=\"email\"/><input type=\"submit\" name=\"submit\" value=\"Update\"/></form>"}}, {"@Nature": "Bad", "@Language": "PHP", "xhtml:div": {"xhtml:br": [null, null, null, null, null, null, null, null, null, null, null, null, null, null], "xhtml:i": ["//if the session is registered to a valid user then allow update", "// The user session is valid, so process the request", "// and update the information"], "xhtml:div": [{"@style": "margin-left:1em;", "xhtml:div": {"xhtml:br": [null, null, null, null, null, null], "xhtml:i": "// Redirect user to login page", "#text": "echo \"invalid session detected!\";\n                           \n                           \n                           [...]\n                           exit;"}}, {"@style": "margin-left:1em;", "xhtml:div": {"xhtml:br": [null, null, null, null, null, null], "xhtml:i": ["// read in the data from $POST and send an update", "// to the database"], "#text": "SendUpdateToDatabase($_SESSION['username'], $_POST['email']);[...]echo \"Your profile has been successfully updated.\";"}}], "#text": "// initiate the session in order to validate sessions\n                     session_start();\n                     \n                     \n                     \n                     if (! session_is_registered(\"username\")) {}\n                     \n                     \n                     \n                     \n                     \n                     \n                     update_profile();\n                     function update_profile {}"}}, {"@Nature": "Attack", "@Language": "HTML", "xhtml:div": {"xhtml:br": [null, null, null, null, null, null, null, null, null, null, null], "xhtml:div": {"@style": "margin-left:1em;", "xhtml:br": [null, null], "xhtml:i": "// send to profile.php", "#text": "form.email = \"attacker@example.com\";\n                        \n                        form.submit();"}, "#text": "<SCRIPT>function SendAttack () {}</SCRIPT>\n                     <BODY onload=\"javascript:SendAttack();\">\n                     <form action=\"http://victim.example.com/profile.php\" id=\"form\" method=\"post\"><input type=\"hidden\" name=\"firstname\" value=\"Funny\"><input type=\"hidden\" name=\"lastname\" value=\"Joke\"><br/><input type=\"hidden\" name=\"email\"></form>"}}]}}, "Observed_Examples": {"Observed_Example": [{"Reference": "CVE-2004-1703", "Description": "Add user accounts via a URL in an img tag", "Link": "https://www.cve.org/CVERecord?id=CVE-2004-1703"}, {"Reference": "CVE-2004-1995", "Description": "Add user accounts via a URL in an img tag", "Link": "https://www.cve.org/CVERecord?id=CVE-2004-1995"}, {"Reference": "CVE-2004-1967", "Description": "Arbitrary code execution by specifying the code in a crafted img tag or URL", "Link": "https://www.cve.org/CVERecord?id=CVE-2004-1967"}, {"Reference": "CVE-2004-1842", "Description": "Gain administrative privileges via a URL in an img tag", "Link": "https://www.cve.org/CVERecord?id=CVE-2004-1842"}, {"Reference": "CVE-2005-1947", "Description": "Delete a victim's information via a URL or an img tag", "Link": "https://www.cve.org/CVERecord?id=CVE-2005-1947"}, {"Reference": "CVE-2005-2059", "Description": "Change another user's settings via a URL or an img tag", "Link": "https://www.cve.org/CVERecord?id=CVE-2005-2059"}, {"Reference": "CVE-2005-1674", "Description": "Perform actions as administrator via a URL or an img tag", "Link": "https://www.cve.org/CVERecord?id=CVE-2005-1674"}, {"Reference": "CVE-2009-3520", "Description": "modify password for the administrator", "Link": "https://www.cve.org/CVERecord?id=CVE-2009-3520"}, {"Reference": "CVE-2009-3022", "Description": "CMS allows modification of configuration via CSRF attack against the administrator", "Link": "https://www.cve.org/CVERecord?id=CVE-2009-3022"}, {"Reference": "CVE-2009-3759", "Description": "web interface allows password changes or stopping a virtual machine via CSRF", "Link": "https://www.cve.org/CVERecord?id=CVE-2009-3759"}]}, "Taxonomy_Mappings": {"Taxonomy_Mapping": [{"@Taxonomy_Name": "PLOVER", "Entry_Name": "Cross-Site Request Forgery (CSRF)"}, {"@Taxonomy_Name": "OWASP Top Ten 2007", "Entry_ID": "A5", "Entry_Name": "Cross Site Request Forgery (CSRF)", "Mapping_Fit": "Exact"}, {"@Taxonomy_Name": "WASC", "Entry_ID": "9", "Entry_Name": "Cross-site Request Forgery"}]}, "Related_Attack_Patterns": {"Related_Attack_Pattern": [{"@CAPEC_ID": "111"}, {"@CAPEC_ID": "462"}, {"@CAPEC_ID": "467"}, {"@CAPEC_ID": "62"}]}, "References": {"Reference": [{"@External_Reference_ID": "REF-44", "@Section": "\"Sin 2: Web-Server Related Vulnerabilities (XSS, XSRF, and\n Response Splitting).\" Page 37"}, {"@External_Reference_ID": "REF-329"}, {"@External_Reference_ID": "REF-330"}, {"@External_Reference_ID": "REF-331"}, {"@External_Reference_ID": "REF-332"}, {"@External_Reference_ID": "REF-333"}, {"@External_Reference_ID": "REF-334"}, {"@External_Reference_ID": "REF-335"}, {"@External_Reference_ID": "REF-45"}, {"@External_Reference_ID": "REF-956"}]}, "Notes": {"Note": [{"@Type": "Relationship", "xhtml:p": "There can be a close relationship between XSS and CSRF (CWE-352).  An attacker might use CSRF in order to trick the victim into submitting requests to the server in which the requests contain an XSS payload.  A well-known example of this was the Samy worm on MySpace [REF-956]. The worm used XSS to insert malicious HTML sequences into a user's profile and add the attacker as a MySpace friend.  MySpace friends of that victim would then execute the payload to modify their own profiles, causing the worm to propagate exponentially. Since the victims did not intentionally insert the malicious script themselves, CSRF was a root cause."}, {"@Type": "Theoretical", "xhtml:p": "The CSRF topology is multi-channel:", "xhtml:ul": {"xhtml:li": ["Attacker (as outsider) to intermediary (as user). The interaction point is either an external or internal channel.", "Intermediary (as user) to server (as victim). The activation point is an internal channel."]}}]}, "Content_History": {"Submission": {"Submission_Name": "PLOVER", "Submission_Date": "2006-07-19"}, "Modification": [{"Modification_Name": "Eric Dalci", "Modification_Organization": "Cigital", "Modification_Date": "2008-07-01", "Modification_Comment": "updated Time_of_Introduction"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2008-09-08", "Modification_Comment": "updated Alternate_Terms, Description, Relationships, Other_Notes, Relationship_Notes, Taxonomy_Mappings"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2009-01-12", "Modification_Comment": "updated Applicable_Platforms, Description, Likelihood_of_Exploit, Observed_Examples, Other_Notes, Potential_Mitigations, References, Relationship_Notes, Relationships, Research_Gaps, Theoretical_Notes"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2009-03-10", "Modification_Comment": "updated Potential_Mitigations"}, {"Modification_Name": "Tom Stracener", "Modification_Date": "2009-05-20", "Modification_Comment": "Added demonstrative example for profile."}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2009-05-27", "Modification_Comment": "updated Demonstrative_Examples, Related_Attack_Patterns"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2009-12-28", "Modification_Comment": "updated Common_Consequences, Demonstrative_Examples, Detection_Factors, Likelihood_of_Exploit, Observed_Examples, Potential_Mitigations, Time_of_Introduction"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2010-02-16", "Modification_Comment": "updated Applicable_Platforms, Detection_Factors, References, Relationships, Taxonomy_Mappings"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2010-06-21", "Modification_Comment": "updated Common_Consequences, Detection_Factors, Potential_Mitigations, References, Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2010-09-27", "Modification_Comment": "updated Potential_Mitigations"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2011-03-29", "Modification_Comment": "updated Description"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2011-06-01", "Modification_Comment": "updated Common_Consequences"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2011-06-27", "Modification_Comment": "updated Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2011-09-13", "Modification_Comment": "updated Potential_Mitigations, References"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2012-05-11", "Modification_Comment": "updated Related_Attack_Patterns, Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2012-10-30", "Modification_Comment": "updated Potential_Mitigations"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2013-02-21", "Modification_Comment": "updated Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2013-07-17", "Modification_Comment": "updated References, Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2014-07-30", "Modification_Comment": "updated Detection_Factors"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2015-12-07", "Modification_Comment": "updated Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2017-11-08", "Modification_Comment": "updated Applicable_Platforms, Likelihood_of_Exploit, Modes_of_Introduction, References, Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2018-03-27", "Modification_Comment": "updated References, Relationship_Notes, Research_Gaps"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2019-09-19", "Modification_Comment": "updated Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2020-02-24", "Modification_Comment": "updated Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2020-06-25", "Modification_Comment": "updated Relationships, Theoretical_Notes"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2020-08-20", "Modification_Comment": "updated Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2021-07-20", "Modification_Comment": "updated Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2021-10-28", "Modification_Comment": "updated Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2022-06-28", "Modification_Comment": "updated Relationships"}, {"Modification_Name": "CWE Content Team", "Modification_Organization": "MITRE", "Modification_Date": "2023-04-27", "Modification_Comment": "updated References, Relationships"}]}}